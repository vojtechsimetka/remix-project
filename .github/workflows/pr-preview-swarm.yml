name: Check

on:
  push:
    branches:
      - 'master'
  pull_request:
    branches:
      - '**'

jobs:
  check:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Use Node.js 18
        uses: actions/setup-node@v3
        with:
          cache: npm
          node-version: 18

      - name: Install npm deps
        if: steps.cache-npm.outputs.cache-hit != 'true'
        run: npm i -f # There are some incompatible versions

      - name: Build typescrip libraries
        run: npm run build

      - name: Build the project
        run: npx @nrwl/cli build       

      - name: Create preview
        uses: ethersphere/swarm-actions/pr-preview@v0
        with:
          bee-url: https://unlimited.gateway.ethswarm.org
          dir: ./dist/apps/remix-ide/
          error-document: index.html
          headers: "${{ secrets.GATEWAY_AUTHORIZATION_HEADER }}"
